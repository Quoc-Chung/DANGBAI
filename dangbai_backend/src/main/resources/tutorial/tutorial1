# ğŸ” Spring Boot Authentication & Authorization System

Há»‡ thá»‘ng xÃ¡c thá»±c vÃ  phÃ¢n quyá»n hoÃ n chá»‰nh cho Spring Boot sá»­ dá»¥ng JWT, Spring Security vÃ  MySQL.

## âœ¨ Features

- âœ… **JWT Authentication** - XÃ¡c thá»±c báº±ng JSON Web Token
- âœ… **Role-Based Access Control (RBAC)** - PhÃ¢n quyá»n dá»±a trÃªn vai trÃ²
- âœ… **Permission-Based Authorization** - PhÃ¢n quyá»n chi tiáº¿t theo permissions
- âœ… **Refresh Token** - LÃ m má»›i token tá»± Ä‘á»™ng
- âœ… **Password Encryption** - MÃ£ hÃ³a máº­t kháº©u báº±ng BCrypt
- âœ… **Custom Annotations** - `@RequiresPermission` cho phÃ¢n quyá»n dá»… dÃ ng
- âœ… **Global Exception Handling** - Xá»­ lÃ½ lá»—i táº­p trung
- âœ… **Input Validation** - Validate dá»¯ liá»‡u Ä‘áº§u vÃ o
- âœ… **Auto Data Initialization** - Tá»± Ä‘á»™ng táº¡o roles, permissions, vÃ  users máº«u
- âœ… **Security Utils** - CÃ¡c utility methods há»— trá»£

## ğŸ› ï¸ Tech Stack

- **Java 17**
- **Spring Boot 3.2.0**
- **Spring Security**
- **Spring Data JPA**
- **MySQL 8.0**
- **JWT (io.jsonwebtoken 0.12.3)**
- **Lombok**
- **Maven**

## ğŸ“ Project Structure

```
src/main/java/
â””â”€â”€ com.quocchung.dangbai.duandangbai/
    â”œâ”€â”€ config/                 # Configuration classes
    â”œâ”€â”€ controller/             # REST Controllers
    â”œâ”€â”€ dto/                    # Data Transfer Objects
    â”œâ”€â”€ exception/              # Exception classes
    â”œâ”€â”€ model/                  # Entity classes
    â”œâ”€â”€ repository/             # JPA Repositories
    â”œâ”€â”€ security/               # Security components
    â””â”€â”€ service/                # Business logic
```

## ğŸš€ Quick Start

### 1. Prerequisites

- JDK 17 hoáº·c cao hÆ¡n
- MySQL 8.0
- Maven 3.6+

### 2. Clone Repository

```bash
git clone <repository-url>
cd duandangbai
```

### 3. Configure Database

Táº¡o database MySQL:

```sql
CREATE DATABASE duandangbai CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

Cáº­p nháº­t `src/main/resources/application.yml`:

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/duandangbai
    username: root
    password: your_password  # Thay Ä‘á»•i password
```

### 4. Build & Run

```bash
# Build
mvn clean install

# Run
mvn spring-boot:run
```

Server cháº¡y táº¡i: `http://localhost:8080`

## ğŸ“š API Documentation

### Authentication Endpoints

| Method | Endpoint | Description | Auth Required |
|--------|----------|-------------|---------------|
| POST | `/api/v1/auth/register` | ÄÄƒng kÃ½ tÃ i khoáº£n má»›i | âŒ |
| POST | `/api/v1/auth/login` | ÄÄƒng nháº­p | âŒ |
| POST | `/api/v1/auth/refresh-token` | LÃ m má»›i token | âŒ |
| POST | `/api/v1/auth/logout` | ÄÄƒng xuáº¥t | âœ… |

### Example: Login Request

```bash
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "123456"
  }'
```

**Response:**
```json
{
  "status": 200,
  "message": "ÄÄƒng nháº­p thÃ nh cÃ´ng",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "userId": 3,
    "username": "admin",
    "email": "admin@gmail.com",
    "displayName": "Quáº£n Trá»‹ ViÃªn",
    "roles": ["ROLE_ADMIN"]
  }
}
```

## ğŸ”‘ Default Accounts

| Username | Password | Role | Description |
|----------|----------|------|-------------|
| admin | 123456 | ADMIN | Quáº£n trá»‹ viÃªn - Full quyá»n |
| employee | 123456 | EMPLOYEE | NhÃ¢n viÃªn - Duyá»‡t bÃ i viáº¿t |
| quocchung | 123456 | USER | NgÆ°á»i dÃ¹ng thÆ°á»ng |

## ğŸ›¡ï¸ Authorization Examples

### 1. Using @PreAuthorize

```java
@GetMapping("/posts")
@PreAuthorize("hasAuthority('POST_CREATE')")
public ResponseEntity<?> getAllPosts() {
    return ResponseEntity.ok("Success");
}
```

### 2. Using Custom @RequiresPermission

```java
@PostMapping("/posts")
@RequiresPermission("POST_CREATE")
public ResponseEntity<?> createPost() {
    return ResponseEntity.ok("Created");
}
```

### 3. Using SecurityUtils

```java
@GetMapping("/my-posts")
public ResponseEntity<?> getMyPosts() {
    Long userId = SecurityUtils.getCurrentUserId();

    if (!SecurityUtils.hasPermission("POST_CREATE")) {
        throw new AuthorizationException(ErrorCode.INSUFFICIENT_PERMISSIONS);
    }

    return ResponseEntity.ok("My posts");
}
```

## ğŸ¯ Permissions Matrix

| Permission | Description | USER | EMPLOYEE | ADMIN |
|------------|-------------|------|----------|-------|
| POST_CREATE | Táº¡o bÃ i viáº¿t | âœ… | âœ… | âœ… |
| POST_EDIT_OWN | Sá»­a bÃ i viáº¿t cá»§a mÃ¬nh | âœ… | âœ… | âœ… |
| POST_APPROVE | Duyá»‡t bÃ i viáº¿t | âŒ | âœ… | âœ… |
| POST_DELETE_ANY | XÃ³a báº¥t ká»³ bÃ i viáº¿t | âŒ | âŒ | âœ… |
| GET_ALL_USER | Xem danh sÃ¡ch user | âŒ | âœ… | âœ… |
| DELETE_USER | XÃ³a user | âŒ | âŒ | âœ… |
| GET_ALL_POST | Xem táº¥t cáº£ bÃ i viáº¿t | âŒ | âœ… | âœ… |

## ğŸ” Security Features

### JWT Configuration
- **Access Token Expiration:** 24 hours
- **Refresh Token Expiration:** 7 days
- **Algorithm:** HS256
- **Secret Key:** Configured in `application.yml`

### Password Security
- **Hashing:** BCrypt with strength 10
- **Validation:** Minimum 6 characters

### Account Status
- `ACTIVE` - TÃ i khoáº£n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng
- `SUSPENDED` - TÃ i khoáº£n bá»‹ táº¡m khÃ³a
- `BANNED` - TÃ i khoáº£n bá»‹ cáº¥m vÄ©nh viá»…n
- `INACTIVE` - TÃ i khoáº£n chÆ°a kÃ­ch hoáº¡t

## ğŸ“ Important Notes

### Production Checklist

- [ ] Thay Ä‘á»•i JWT secret key
- [ ] Sá»­ dá»¥ng biáº¿n mÃ´i trÆ°á»ng cho sensitive data
- [ ] Enable HTTPS
- [ ] Implement Rate Limiting
- [ ] Add Token Blacklist cho Logout
- [ ] Enable SQL injection protection
- [ ] Add CORS configuration phÃ¹ há»£p
- [ ] Implement Email verification
- [ ] Add Password reset functionality
- [ ] Enable Audit Logging

### Environment Variables (Recommended)

```bash
export JWT_SECRET=your-very-long-and-secure-secret-key-here
export DB_USERNAME=your_db_username
export DB_PASSWORD=your_db_password
export DB_URL=jdbc:mysql://localhost:3306/duandangbai
```

## ğŸ§ª Testing

Chi tiáº¿t vá» testing xem file [API_TESTING.md](API_TESTING.md)

```bash
# Test vá»›i cURL
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'
```

## ğŸ› Troubleshooting

### Common Issues

**1. Database Connection Failed**
- Kiá»ƒm tra MySQL service Ä‘ang cháº¡y
- Verify credentials trong `application.yml`
- Äáº£m báº£o database Ä‘Ã£ Ä‘Æ°á»£c táº¡o

**2. 401 Unauthorized**
- Kiá»ƒm tra token cÃ³ Ä‘Ãºng format: `Bearer <token>`
- Token cÃ³ thá»ƒ Ä‘Ã£ háº¿t háº¡n, thá»­ refresh

**3. 403 Forbidden**
- User khÃ´ng cÃ³ quyá»n truy cáº­p
- Kiá»ƒm tra role vÃ  permissions

## ğŸ“– Additional Resources

- [Spring Security Documentation](https://docs.spring.io/spring-security/reference/)
- [JWT.io](https://jwt.io/)
- [Spring Boot Documentation](https://docs.spring.io/spring-boot/docs/current/reference/html/)

## ğŸ‘¨â€ğŸ’» Author

**Tá»« Quá»‘c Chung**
- Email: tuquocchung@gmail.com
- Phone: 0365484829

## ğŸ“„ License

This project is licensed under the MIT License.

---

**â­ Náº¿u project há»¯u Ã­ch, Ä‘á»«ng quÃªn star nhÃ©!**